<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
	<!--<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self';">-->
	<title>cockatiel | by vulbyte</title>
	<meta http-equiv="Content-Security-Policy" content="script-src: 'self' 'unsafe-inline';">
	<link rel="stylesheet" href="./global.css">
	</link>
	<script type="module" src="./configs/load_user_config.js"></script>
</head>

<body>
	<hgroup style="display:flex; justify-content:space-around; height:3em !important; border-radius: 0px;">
		<img style="max-height:100%; width:3em;" src="./non-code_assets/cockatiel_logo.png">
		<h1>cockatiel</h1>
		<h6>by vulbyte</h6>
		<img style="max-height:100%; width:3em;" src='./non-code_assets/vulbyte_icon.svg'>
	</hgroup>

	<div>
		<h2>📺 stream stuff 📺</h2>
		stream link: <input type="text" id="stream_link"><br><br>
		formatted: <output id="formatted_stream_link"></output>
		<script type="module">

			import {UpdateStreamLink} from './lib/parse_stream_link.js';
			document.getElementById("stream_link").addEventListener("change", (e) => {
				console.log("parsing stream link");
				document.getElementById("formatted_stream_link").formatted_stream_link = UpdateStreamLink();
			});

		</script>
	</div>

	<hr>

	<div id="api_stuff">
		<h2>🛜 api stuff 🛜</h2>
		<u><em>DONT SHARE THIS WITH ANYONE, DO NOT VIEW ON STREAM</em> </u> <br>
		api key: <input type="password" id="api_key">
		<button id="password_visibility_toggle" placeholder="">👁️</button>
		<button id="load_api_key" placeholder="">↺</button>
		<button id="save_api_key" placeholder="">💾</button> <br>
		<output id="api_info"></output>
		<script type="module">
			import {config, SaveConfig} from "./configs/load_user_config.js";
			console.log(config);

			//{{{4 save to config
			document.getElementById("save_api_key").addEventListener("mousedown", (e) => {
				console.log("saving api to file");
				config.global_config.APIs.gcloud_key = document.getElementById("api_key").value;
				console.log(config.global_config.APIs.gcloud_key);
				SaveConfig("global");
			})
			//}}}4



			//{{{4 load prev api key
			document.getElementById("load_api_key").addEventListener("mousedown", (e) => {
				console.log("loading prev api key");

				try {
					console.log(config.global_config.APIs);
					document.getElementById("api_key").value = config.global_config.APIs.gcloud_key;
					document.getElementById("api_info").innerText = "loaded previously saved api key";
				}
				catch (err) {
					console.warn(err);
					document.getElementById("api_info").innerText = "failed to laod api, did you save one before?";
				}

			});
			//}}}4 load prev api key



			//{{{4 set api key on change
			const api_key_val = document.getElementById('api_key')

			api_key_val.addEventListener("change", async (e) => {
				console.log("attempting to update api key");

				if (api_key_val.value.length < 8) {
					document.getElementById("api_info").innerText = "key seems a bit small";
				}
				else if (api_key_val.value.length > 32) {
					document.getElementById("api_info").innerText = "key seems a bit large";
				}
				else {
					document.getElementById("api_info").innerText = "key seems good at a glance";
				}
			});
			//}}}4 set api key on change



			//{{{4 show on mouse down
			document.getElementById("password_visibility_toggle").addEventListener("mousedown", (e) => {
				console.log("showing password")
				if (document.getElementById("api_key").type == "password") {
					document.getElementById("api_key").type = "text";
				}
			})
			//}}}4 show on mouse down



			//{{{4 hide on mouse up
			document.getElementById("password_visibility_toggle").addEventListener("mouseup", (e) => {
				console.log("hiding password");
				document.getElementById("api_key").type = "password";
			})
			//}}}4 hide on mouse up
		</script>
	</div>

	<hr>

	<!-- {{{2 test_tts -->
	<div>
		<h2> 🛝 testing playground 🛝</h2>
		<summary>test tts</summary>
		<input type="text" id="test_input">
		<button id="test_tts_button">></button>
		<script type="module">

			import {CallTTS} from './lib/call_tts.js'
			document.getElementById("test_tts_button").addEventListener("click", (e) => {
				console.log("attempting to speak");
				let tts_message = document.getElementById("test_input").value;
				CallTTS(tts_message);
			});

		</script>
		<!-- }}}2 -->
		<br>
	</div>

	<div>
		<h2>💬 messages: 💬</h2>
		<details style="
				max-height: 30em;
				overflow-x:scroll;
				overflow-y: scroll;
				scroll-snap-align:end;
			">
			<summary>all messages contained here</summary>
			<ol id="messages_list" style="
					display:flex;
					flex-direction: column-reverse;
					"></ol>
		</details>
	</div>
</body>

<div style="background-color:var(--color_primary); color: white;">
	We are using Node.js <span id="node-version"></span>,
	Chromium <span id="chrome-version"></span>,
	and Electron <span id="electron-version"></span>.
</div>

<footer style="
			background-color: #ffffff;
			bottom: 0px;
			color: #000000;
			display:flex;
			justify-content: space-between;
			max-height: auto;
			position: sticky;
	">
	<div style="display:flex; flex-direction:row;">
		<div style="display:flex; flex-direction:column; width:20em;">
			<div>
				<!-- TODO: fix this vvvvvv -->
				<span style="color:black;">message check freq in seconds (min 0.5, max 60):</span>
				<input id="update_freq" type="value" min="0.5" max="60" placeholder="10"></input>
				<button id="play_tts" style="background-color:limegreen;">start monitoring messages</button>
				<script type="module">
					import {config} from "./configs/load_user_config.js";
					import {StartGettingMessages} from './lib/get_livestream_messages.js';

					document.getElementById("play_tts").addEventListener("click", (e) => {
						config.user_config.stream_url = document.getElementById("formatted_stream_link").innerText;
						StartGettingMessages({oneshot: false});
					});
				</script>
				<button id="stop_tts" style="background-color:coral;">stop monitoring messages</button>
				<script type="module">
					import {StopGettingMessages} from "./lib/get_livestream_messages.js";

					document.getElementById("stop_tts").addEventListener("click", (e) => {
						console.log("stopping message listener");
						StopGettingMessages();
					})
				</script>
			</div>
		</div>


		<!--
		<div>
			<input id="message_index" type="value" placeholder="no index... yet..."></input>
			<br>
			<button id="play_tts">play next tts</button>
			<script type="module">

				document.getElementById("play_tts").addEventListener(
					"click", (e) => {
						import {message_index, ReadNextMessage} from './lib/get_livestream_messages.js';

						if (document.getElementById("message_index").value == undefined) {
							document.getElementById("message_index").value = message_index;
						}
						else {
							message_index = document.getElementById("message_index").value;
						}
					}
				);

			</script>
			<br>
			<output id="next_tts_message" style="background-color: black;">no message queue'd</output>
			<br>
			<br>
			<button id="skip_next_tts_message">skip next message</button>
		</div>
	-->

		<!--<script type="module" src="./lib/read_message.js"></script>-->
	</div>
	<div style="color:black; padding: 1em">
		tts_queue_length: <div style="background-color:black; color:white;" id="tts_queue_indicator">err</div>
	</div>
</footer>

</html>
